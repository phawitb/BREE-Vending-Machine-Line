<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LINE Login Redirect</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h4>üîê Logging in with LINE...</h4>
  <script>
    async function initLiff() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        const vmId = urlParams.get('vmId') || 'M0001';  // default fallback

        await liff.init({ liffId: "{{ liff_id }}" });

        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href }); // re-login if needed
        } else {
          window.location.href = `/${vmId}`;
        }
      } catch (err) {
        console.error("LIFF failed:", err);
        document.body.innerHTML = "<h3 style='color:red;'>LIFF failed to initialize. Please check LIFF ID or endpoint.</h3>";
      }
    }

    window.onload = initLiff;
  </script>
</body>
</html>
